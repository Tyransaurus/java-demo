<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Challenges</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

<div th:replace="_fragments :: header(${page})"></div>

<main class="container">

  <!-- Two Sum -->
  <section class="card" id="twoSumSection">
    <h3>Two Sum</h3>
    <form class="row ajax" action="/challenges/two-sum" method="post" data-target="#twoSumResult" autocomplete="off">
      <input class="input" type="text" name="numbers" placeholder="e.g. 1,2,3,4,5,6,7,8,9,10" required>
      <input class="input" type="number" name="target" placeholder="Target" required>
      <button class="btn">Compute</button>
      <input type="hidden" name="fragment" value="true">
    </form>
    <div id="twoSumResult" th:fragment="twoSumResultFrag">
      <div class="mt-2" th:utext="${vm.twoSumResult}"></div>
    </div>
  </section>

  <!-- Reverse String -->
  <section class="card" id="reverseSection">
    <h3>Reverse String</h3>
    <form class="row ajax" action="/challenges/reverse" method="post" data-target="#reverseResult" autocomplete="off">
      <input class="input" type="text" name="text" placeholder="Type text..." required>
      <button class="btn">Reverse</button>
      <input type="hidden" name="fragment" value="true">
    </form>
    <div id="reverseResult" th:fragment="reverseResultFrag">
      <div class="mt-2" th:text="${vm.reverseStringResult}"></div>
    </div>
  </section>

  <!-- Valid Parentheses -->
  <section class="card" id="vpSection">
    <h3>Valid Parentheses</h3>
    <form class="row ajax" action="/challenges/valid-parentheses" method="post" data-target="#vpResult">
      <input class="input" type="text" name="text" placeholder="e.g. {[()()]}" required>
      <button class="btn">Check</button>
      <input type="hidden" name="fragment" value="true">
    </form>
    <div id="vpResult" th:fragment="validParensResultFrag">
      <div class="mt-2" th:text="${vm.validParenthesesResult}"></div>
    </div>
  </section>

  <!-- Group Anagrams -->
  <section class="card" id="anagramsSection">
    <h3>Group Anagrams</h3>
    <form class="row ajax" action="/challenges/anagrams" method="post" data-target="#anagramsResult">
      <input class="input" type="text" name="words" placeholder="tea eat ate tan nat bat" required>
      <button class="btn">Group</button>
      <input type="hidden" name="fragment" value="true">
    </form>
    <div id="anagramsResult" th:fragment="anagramsResultFrag">
      <ul class="list" th:if="${vm.anagramsResult}">
        <li th:each="g : ${vm.anagramsResult}">
          <span th:text="${#strings.arrayJoin(g.toArray(), ', ')}">tea, eat</span>
        </li>
      </ul>
    </div>
  </section>

  <!-- Longest Substring -->
  <section class="card" id="lsSection">
    <h3>Longest Unique-Char Substring</h3>
    <form class="row ajax" action="/challenges/longest-substring" method="post" data-target="#lsResult">
      <input class="input" type="text" name="text" placeholder="e.g. abcabcbb" required>
      <button class="btn">Compute</button>
      <input type="hidden" name="fragment" value="true">
    </form>
    <div id="lsResult" th:fragment="longestSubstringResultFrag">
      <div class="mt-2" th:text="${vm.longestSubstringResult}"></div>
    </div>
  </section>

  <!-- Merge Intervals -->
  <section class="card" id="miSection">
    <h3>Merge Intervals</h3>
    <form class="row ajax" action="/challenges/merge-intervals" method="post" data-target="#miResult">
      <input class="input" type="text" name="ranges" placeholder="1-3,2-6,8-10,15-18" required>
      <button class="btn">Merge</button>
      <input type="hidden" name="fragment" value="true">
    </form>
    <div id="miResult" th:fragment="mergeIntervalsResultFrag">
      <div class="mt-2" th:text="${vm.mergeIntervalsResult}"></div>
    </div>
  </section>

  <section class="card">
  <h3>Palindrome (Client-side JS)</h3>
  <div class="row">
    <input class="input" id="palInput" type="text" placeholder="e.g. A man, a plan, a canal: Panama">
    <button class="btn" type="button" onclick="checkPal()">Check</button>
  </div>
  <div id="palResult" class="mt-2 muted"></div>
</section>

<script>
function checkPal() {
  const s = document.getElementById('palInput').value;
  const norm = (s || '').toLowerCase().replace(/[^a-z0-9]/g, '');
  const ok = norm === [...norm].reverse().join('');
  document.getElementById('palResult').textContent = ok ? 'Palindrome ✅' : 'Not a palindrome ❌';
}
</script>

</main>

<div th:replace="_fragments :: footer"></div>

<!-- Tiny AJAX helper -->
<script>
document.addEventListener('submit', async (e) => {
  const form = e.target;
  if (!form.classList.contains('ajax')) return;
  e.preventDefault();
  const targetSel = form.getAttribute('data-target');
  const targetEl = document.querySelector(targetSel);
  const resp = await fetch(form.action, { method: 'POST', body: new FormData(form) });
  const html = await resp.text();
  // Create a temp container to parse returned fragment
  const tmp = document.createElement('div');
  tmp.innerHTML = html.trim();
  // Replace the target content with the fragment body
  const newFrag = tmp.firstElementChild || tmp;
  targetEl.replaceWith(newFrag);
});
</script>

</body>
</html>